{% extends "tasks/base.html" %}
{% block title %}–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ ‚Äî TaskFlow{% endblock %}
{% block content %}

<div class="page-header">
    <div>
        <h1 class="page-title">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h1>
        <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã</p>
    </div>
    <a href="{% url 'user_create' %}" class="btn-primary">+ –ù–æ–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</a>
</div>

<!-- FILTER -->
<div class="filter-bar">
    <form method="get" class="filter-form">
        <input type="text" name="search" value="{{ search }}" class="form-input search-input" placeholder="–ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...">
        <select name="department" class="form-input filter-select" onchange="this.form.submit()">
            <option value="">–í—Å–µ –æ—Ç–¥–µ–ª—ã</option>
            {% for dept in departments %}
                <option value="{{ dept.id }}" {% if dept_filter == dept.id|stringformat:"s" %}selected{% endif %}>{{ dept.name }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn-ghost btn-sm">–ù–∞–π—Ç–∏</button>
    </form>
</div>

<!-- USERS TABLE -->
<div class="table-card">
    {% if users %}
    <table class="tasks-table">
        <thead>
            <tr>
                <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                <th>–û—Ç–¥–µ–ª</th>
                <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                <th>–†–æ–ª—å</th>
                <th>Email</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>
                    <div class="user-cell">
                        <div class="member-avatar member-avatar-sm" style="background: {{ user.profile.avatar_color }}">
                            {{ user.profile.initials }}
                        </div>
                        <span class="user-cell-name">{{ user.profile.display_name }}</span>
                    </div>
                </td>
                <td>{{ user.profile.department|default:"‚Äî" }}</td>
                <td>{{ user.profile.position|default:"‚Äî" }}</td>
                <td>
                    <span class="role-badge role-{{ user.profile.role }}">{{ user.profile.get_role_display }}</span>
                </td>
                <td class="text-muted">{{ user.email }}</td>
                <td>
                    {% if user.is_active %}
                        <span class="status-badge status-badge-done">–ê–∫—Ç–∏–≤–µ–Ω</span>
                    {% else %}
                        <span class="status-badge status-badge-todo">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                    {% endif %}
                </td>
                <td class="table-actions">
                    <a href="{% url 'user_edit' user.pk %}" class="btn-ghost btn-xs">‚úé</a>
                    {% if user != request.user %}
                        <a href="{% url 'user_delete' user.pk %}" class="btn-ghost btn-xs btn-danger">‚úï</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state-full">
        <div class="empty-icon">üë•</div>
        <h2>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h2>
        <p>–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</p>
    </div>
    {% endif %}
</div>

{% endblock %}
